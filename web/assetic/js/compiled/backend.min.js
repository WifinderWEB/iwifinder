ConfigPiZone={pathToTmpl:"/bundles/pizonebackend/tmpl/",pathToImg:"/bundles/pizonebackend/img/",apiPrefix:"/app_dev.php/api",editorFull:{height:300,toolbar:[["headline",["style"]],["style",["bold","italic","underline","superscript","subscript","strikethrough","clear"]],["textsize",["fontsize"]],["fontclr",["color"]],["alignment",["ul","ol","paragraph","lineheight"]],["height",["height"]],["table",["table"]],["insert",["link","picture","hr"]],["view",["fullscreen","codeview"]],["help",["help"]]]}};
var DataProcessing={Normalize:function(a){$.each(a,function(c,b){a[c].template=FieldDispatcher.GetLayout(b.type);if(b.type=="checkbox"){if(b.value==1){a[c].value=true}else{a[c].value=false}}if(b.compound){a[c].form=DataProcessing.Normalize(a[c].form)}});return a}};
var EventDispatcher={events:[],AddEventListener:function(c,d,b){if(!b){b=""}this.events[c]=this.events[c]||[];if(this.events[c]){var a=EventDispatcher.HashCode(d.toString()+b);this.RemoveEventListener(c,d,b,a);this.events[c].push({hash:a,callback:d})}},RemoveEventListener:function(e,f,d,a){if(this.events[e]){var c=this.events[e];for(var b=c.length-1;b>=0;--b){if(c[b].hash===a){c.splice(b,1);return true}}}return false},DispatchEvent:function(c,d){if(this.events[c]){var b=this.events[c],a=b.length;while(a--){b[a].callback(d)}}},HashCode:function(d){var c=0,a,b;if(d.length===0){return c}for(a=0;a<d.length;a++){b=d.charCodeAt(a);c=((c<<5)-c)+b;c=c&c}return c},GetUUID:function(){var a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var d=Math.random()*16|0,b=e=="x"?d:(d&3|8);return b.toString(16)});return a}};
var FieldDispatcher={path:ConfigPiZone.pathToTmpl+"form/",GetLayout:function(a){if(a=="text"){return this.path+"_text_field.html"}if(a=="textarea"){return this.path+"_textarea_field.html"}if(a=="hidden"){return this.path+"_hidden_field.html"}if(a=="checkbox"){return this.path+"_checkbox_field.html"}if(a=="choice"){return this.path+"_choice_field.html"}if(a=="editor"){return this.path+"_editor_field.html"}}};
function Notify(f){var b=this;b.title=null;b.text=null;b.type=null;b.shadow=null;b.opacity=null;b.type=null;b.noteStack=null;b.delay=null;b.stacks={stack_top_right:{dir1:"down",dir2:"left",push:"top",spacing1:10,spacing2:10},stack_top_left:{dir1:"down",dir2:"right",push:"top",spacing1:10,spacing2:10},stack_bottom_left:{dir1:"right",dir2:"up",push:"top",spacing1:10,spacing2:10},stack_bottom_right:{dir1:"left",dir2:"up",push:"top",spacing1:10,spacing2:10},stack_bar_top:{dir1:"down",dir2:"right",push:"top",spacing1:0,spacing2:0},stack_bar_bottom:{dir1:"up",dir2:"right",spacing1:0,spacing2:0},stack_context:{dir1:"down",dir2:"left",context:$("#stack-context")}};function e(){d();a()}function d(){b.title=f.hasOwnProperty("title")?f.title:"";b.text=f.hasOwnProperty("text")?f.text:"";b.type=f.hasOwnProperty("type")?f.type:"info";b.shadow=f.hasOwnProperty("shadow")?f.shadow:true;b.opacity=f.hasOwnProperty("opacity")?f.opacity:1;b.noteStack=f.hasOwnProperty("noteStack")?f.noteStack:"stack_top_right";b.delay=f.hasOwnProperty("delay")?f.delay:"2000"}function a(){new PNotify({title:b.title,text:b.text,shadow:b.shadow,opacity:b.opacity,addclass:b.noteStack,type:b.type,stack:b.stacks[b.noteStack],width:c(),delay:b.delay})}function c(){if(b.noteStack=="stack_bar_top"){return"100%"}if(b.noteStack=="stack_bar_bottom"){return"70%"}else{return"290px"}}e()};
var Loader=function(b,c){var a=this;a.content=b;a.imgSrc=ConfigPiZone.pathToImg+"ajax-loader.gif";a.loader=null;a.width=0;a.height=0;a.ready=false;a.Create=function(){a.ready=true;a.width=a.content.width()?a.content.width():"100%";a.height=a.content.height()?a.content.height():32;a.content.hide();a.loader=a.GetHtmlLoader();a.content.after(a.loader)};a.GetHtmlLoader=function(){var e=$("<div></div>").addClass("loader");if(c){e.addClass(c)}var d=$("<img>").attr({src:a.imgSrc}).css({marginTop:(a.height/2)-16});e.html(d).width(a.width).height(a.height);return e};a.Delete=function(){$(".loader").remove();a.content.show()}};
var PiZoneException={AjaxError:function(b,a,c){if(a){a.Delete()}if(b.hasOwnProperty("responseJSON")){new Notify({type:"danger",title:"Ошибка "+b.responseJSON.code,text:b.responseJSON.message})}if(c){c()}}};
var Base64={keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Encode:function(c){var a="";var k,h,f="";var j,g,e,d="";var b=0;do{k=c.charCodeAt(b++);h=c.charCodeAt(b++);f=c.charCodeAt(b++);j=k>>2;g=((k&3)<<4)|(h>>4);e=((h&15)<<2)|(f>>6);d=f&63;if(isNaN(h)){e=d=64}else{if(isNaN(f)){d=64}}a=a+this.keyStr.charAt(j)+this.keyStr.charAt(g)+this.keyStr.charAt(e)+this.keyStr.charAt(d);k=h=f="";j=g=e=d=""}while(b<c.length);return a},Decode:function(d){var b="";var l,j,g="";var k,h,f,e="";var c=0;var a=/[^A-Za-z0-9\+\/\=]/g;if(a.exec(d)){window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding.")}d=d.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{k=this.keyStr.indexOf(d.charAt(c++));h=this.keyStr.indexOf(d.charAt(c++));f=this.keyStr.indexOf(d.charAt(c++));e=this.keyStr.indexOf(d.charAt(c++));l=(k<<2)|(h>>4);j=((h&15)<<4)|(f>>2);g=((f&3)<<6)|e;b=b+String.fromCharCode(l);if(f!=64){b=b+String.fromCharCode(j)}if(e!=64){b=b+String.fromCharCode(g)}l=j=g="";k=h=f=e=""}while(c<d.length);return b}};
function AuthInterceptor(a,b,c,e,d){return{request:function(f){f.headers=f.headers||{};if(c.get("token")){d.isAuthorized=true;f.headers.Authorization="Basic "+c.get("token")}return f},responseError:function(f){if(f.status===401||f.status===403){e.path("/login");c.remove("token");return b.reject(f)}else{return b.reject(f)}}}}AuthInterceptor.$inject=["$rootScope","$q","$cookies","$location","$sessionStorage"];
function TabPizone(){return function(c,b,a){$(b).click(function(){$(this).tab("show");return false})}};
function ButtonActivePizone(){return{restrict:"A",scope:{ngModel:"="},template:'<button type="button" class="btn btn-xs btn-success" ng-if="ngModel.isActive" ng-click="ngModel.Click.Active()"><i class="fa fa-check"></i></button><button type="button" class="btn btn-xs btn-warning" ng-if="!ngModel.isActive" ng-click="ngModel.Click.Active()"><i class="fa fa-minus"></i></button>'}};
function ListButtonGroupPizone(){var a=["$scope",function(c){function d(){c.model=angular.copy(c.ngModel)}d();c.Edit=function(){window.location.hash="/"+c.listButtonGroupPizone+"/"+c.model.id+"/edit/"}}];var b='<div class="bs-component"><div class="btn-group"><button type="button" class="btn btn-xs btn-dark light" ng-click="Edit()"><i class="fa fa-edit"></i></button><button type="button" class="btn btn-xs btn-danger" ng-click="model.Delete()"><i class="fa fa-trash"></i></button></div></div>';return{restrict:"A",scope:{ngModel:"=",listButtonGroupPizone:"="},controller:a,template:b}};
function PerPagePizone(){return{restrict:"A",scope:{listLength:"=",changePerPage:"=",perPagePizone:"="},template:'<span>Результатов <a href="" class="btn btn-xs btn-default btn-gradient dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="glyphicon glyphicon-cog fs13"></i> {{listLength}} </a><ul class="dropdown-menu checkbox-persist pull-right text-left" role="menu"><li ng-repeat="item in paginate" ng-class="{true: \'active\'}[item == perPagePizone.max_per_page]"><a ng-click="changePerPage(item)">показать {{item}}</a></li></ul></span> из <span class="badge">{{perPagePizone.nb_result}}</span>',link:function(c,b,a){c.paginate=[10,20,50,100]}}};
function FieldSortPizone(){var b='{{fieldLabel}} <a ng-click="ClickSort()" ng-show="sort != fieldAlias"><i class="glyphicon glyphicon-sort"></i></a><a ng-click="ClickSort()" ng-show="sort == fieldAlias && orderBy == \'asc\'"><i class="glyphicon" ng-class="{true: \'glyphicon-sort-by-order\', false: \'glyphicon-sort-by-alphabet\' }[fieldType == \'int\']"></i></a><a ng-click="ClickSort()" ng-show="sort == fieldAlias && orderBy == \'desc\'"><i class="glyphicon" ng-class="{true: \'glyphicon-sort-by-order-alt\', false: \'glyphicon-sort-by-alphabet-alt\' }[fieldType == \'int\']"></i></a>';var a=["$scope","$state",function(c,d){c.sort=d.params.sort;c.orderBy=d.params.order_by;if(c.fieldAlias!=c.sort){c.orderBy=""}c.newOrderBy=(c.orderBy=="asc"||self.sort=="")?"desc":"asc";c.ClickSort=e;function e(){d.go(d.current.name,{pageId:d.params.pageId,sort:c.fieldAlias,order_by:c.newOrderBy})}}];return{restrict:"A",scope:{fieldAlias:"=",fieldLabel:"=",fieldType:"="},template:b,controller:a}};
function ListCtrl(j,g,i,a){j.prefix="";j.model={};j.pageId=i.pageId;j.order={sort:i.sort,order_by:i.order_by};j.perPage=10;j.list=[];j.pager={};j.filters={};j.pathToTmpl=ConfigPiZone.pathToTmpl;j.breadcrumbs=[];j.route="";j.Click={Add:c,Page:h,ChangePerPage:e,Filters:f};j.Init=d;function d(){j.route="/"+j.prefix+"/";var k=$.cookie("pizone_"+j.prefix+"_max_per_page");if(k){j.perPage=k}b();EventDispatcher.DispatchEvent("change-route",j.breadcrumbs);EventDispatcher.AddEventListener("update_page_"+j.prefix,function(){b();j.$apply()})}function c(){window.location.hash="/"+j.prefix+"/new/"}function h(k){window.location.hash="/"+j.prefix+"/"+k}function e(k){if(k!=j.perPage){$.cookie("pizone_"+j.prefix+"_max_per_page",k);window.location.hash="/"+j.prefix+"";j.perPage=k;b()}}function b(){var k=ConfigPiZone.apiPrefix+"/"+j.prefix+"";var l=[];if(j.pageId){l.push("page="+j.pageId)}if(j.perPage){l.push("perPage="+j.perPage)}if(j.order.sort&&j.order.order_by){l.push("sort="+j.order.sort+"&order_by="+j.order.order_by)}if(l.length>0){k=k+"?"+l.join("&")}j.list=[];g.get(k).success(function(m){j.pager=m.pager;j.filters=DataProcessing.Normalize(m.filters);$.each(m.list,function(n,o){j.list.push(new j.model(j,n,o,a))})})}function f(){a.showModal({templateUrl:ConfigPiZone.pathToTmpl+"admindesignes/filters.html",controller:"FiltersCtrl",id:"filterModal",inputs:{title:"Фильтры",fields:j.filters}}).then(function(k){})}}ListCtrl.$inject=["$scope","$http","$stateParams","ModalService"];
function NewCtrl(m,k){m.prefix="";m.fields={};m.tabs={};m.action=null;m.formId="";m.pathToTmpl=ConfigPiZone.pathToTmpl;m.breadcrumbs=[];m.messages={submit:{success:{title:"Сохранение",message:"Успешно создан новый контент"},danger:{title:"Ошибка",message:"Исправте ошибки возникшие при заполнении формы и попробуйте сохранить её еще раз"}}};m.Click={ToList:a,Submit:l};m.Init=e;m.Get={Tabs:f,Fields:c,Values:i,Layout:d};m.Callback={Init:function(){},Success:h,Error:j};m.ParseData=g;m.ToList=a;function e(){m.Get.Layout(function(){m.Callback.Init();EventDispatcher.DispatchEvent("change-route",m.breadcrumbs)})}function a(){window.location.hash="/"+m.prefix+"/"}function l(){var o=$("#"+m.formId);var n=new Loader(o);$.ajax({url:m.action,type:"post",data:m.Get.Values(),dataType:"json",beforeSend:function(){if(n.ready==false){n.Create()}},error:function(p){PiZoneException.AjaxError(p,n)},success:function(p){n.Delete();if(p.result=="ok"){m.Callback.Success(p);b("submit","success")}else{m.Callback.Error(p);b("submit","danger")}}})}function b(o,n){new Notify({type:n,title:m.messages[o][n].title,text:m.messages[o][n].message})}function g(n){var o=DataProcessing.Normalize(n.fields);m.Get.Tabs(o);m.Get.Fields(o);m.action=n.action}function i(){return $("#"+m.formId).serialize()}function d(n){k.get(ConfigPiZone.apiPrefix+"/"+m.prefix+"/new").success(function(o){m.ParseData(o);if(n){n()}})}function c(n){m.fields=[]}function f(n){m.tabs=[]}function h(n){m.ToList()}function j(n){m.ParseData(n);m.$apply()}}NewCtrl.$inject=["$scope","$http"];
function EditCtrl(h,r,n,j){h.id=n.id;h.prefix="";h.title=null;h._delete_token="";h.fields={};h.tabs={};h.action=null;h.formId="";h.pathToTmpl=ConfigPiZone.pathToTmpl;h.Click={ToList:k,Submit:e,Delete:c};h.breadcrumbs=[];h.messages={submit:{success:{title:"Обновление",message:"Контент успешно обновлен"},danger:{title:"Ошибка обновления",message:"Исправте ошибки возникшие при заполнении формы и попробуйте сохранить её еще раз"}},remove:{confirm:{title:"Удаление элемента",message:"Вы уверенны, что хотите удалить элемент?",info:""},success:{title:"Удаление",message:"Элемент успешно удален"},danger:{title:"Ошибка удаления",message:"Возникла ошибка при удалении элемента."}}};h.Get={Tabs:q,Fields:g,Values:a,Layout:o};h.Callback={Init:function(){},Submit:{Success:m,Error:l},Delete:{Before:function(){},Success:function(){h.$state.go(h.prefix)},Error:function(){}}};h.ParseData=b;h.ToList=k;h.Init=s;function s(){h.Get.Layout(function(){h.Callback.Init();EventDispatcher.DispatchEvent("change-route",h.breadcrumbs)})}function k(){window.location.hash="/"+h.prefix+"/"}function e(){var u=$("#"+h.formId);var t=new Loader(u);$.ajax({url:h.action,type:"post",data:h.Get.Values(),dataType:"json",beforeSend:function(){if(t.ready==false){t.Create()}},error:function(v){PiZoneException.AjaxError(v,t)},success:function(v){t.Delete();if(v.result=="ok"){h.Callback.Submit.Success(v);p("submit","success")}else{h.Callback.Submit.Error(v);p("submit","danger")}}})}function p(u,t){new Notify({type:t,title:h.messages[u][t].title,text:h.messages[u][t].message})}function c(){j.showModal({templateUrl:ConfigPiZone.pathToTmpl+"admindesignes/confirm.html",controller:"ModalCtrl",id:"modalConfirm",inputs:{title:h.messages.remove.confirm.title,message:h.messages.remove.confirm.message}}).then(function(t){t.scope.Callback.Confirm=f;h.Callback.Delete.Before(t.scope)})}function f(){var t=ConfigPiZone.apiPrefix+"/"+h.prefix+"/"+h.id+"/delete";$.ajax({url:t,dataType:"json",type:"post",data:{_token:h._delete_token},error:function(u){if(u.status==404){h.messages.remove.danger.message="Элемент с [id] = "+h.list[i].id+" не существует!"}if(u.status==400){h.messages.remove.danger.message="Неверные параметры запроса!"}if(u.status==500){h.messages.remove.danger.message="Возникла непредвиденная ошибка сервера!"}h.Callback.Delete.Error();p("delete","danger")},success:function(u){if(u.result=="ok"){h.Callback.Delete.Success();p("delete","success")}else{h.Callback.Delete.Error();p("delete","danger")}h.$apply()}})}function a(){return $("#"+h.formId).serialize()}function o(t){r.get(ConfigPiZone.apiPrefix+"/"+h.prefix+"/"+h.id+"/edit").success(function(u){h.ParseData(u);if(t){t()}})}function d(t){if(t.show_editor_anons.checked){t.anons.type="editor";t.anons.editorConfig=ConfigPiZone.editorFull}if(t.show_editor_content.checked){t.content.type="editor";t.content.editorConfig=ConfigPiZone.editorFull}return t}function b(t){var u=DataProcessing.Normalize(t.fields);h.Get.Tabs(u);h.Get.Fields(u);h.action=t.action;h._delete_token=t._delete_token}function g(t){h.fields=[]}function q(t){h.tabs=[]}function m(t){h.ToList()}function l(t){h.ParseData(t);h.$apply()}}EditCtrl.$inject=["$scope","$http","$stateParams","ModalService"];
function MainCtrl(a){$("body").attr("class","ng-scope sb-l-o sb-r-c");Core.init()}MainCtrl.$inject=["$scope"];
function BreadcrumbsCtrl(a){a.items=[];function b(){EventDispatcher.AddEventListener("change-route",function(c){a.items=c})}b()}BreadcrumbsCtrl.$inject=["$scope"];
function UserInfoCtrl(c,b){c.logoutButtonId="logoutButtonId";c.Click={Logout:a};function a(){var e=$("#"+c.logoutButtonId);var d=new Loader(e);$.ajax({url:ConfigPiZone.apiPrefix+"/logout",type:"post",dataType:"json",beforeSend:function(){if(d.ready==false){d.Create()}},error:function(f){PiZoneException.AjaxError(f,d)},success:function(f){d.Delete();if(f.result=="ok"){b.ClearCredentials();c.$state.go("login")}else{}}})}}UserInfoCtrl.$inject=["$scope","SessionService"];
function ModalCtrl(b,f,d,a,e){b.title=f;b.message=d;b.info="";b.infoBlockId="infoBlockId";b.Click={Confirm:function(){$.magnificPopup.close();b.Callback.Confirm();e(null,500)},Cancel:function(){$.magnificPopup.close();e(null,500)}};b.Callback={Confirm:function(){},Init:function(){}};function c(){b.Callback.Init()}a.trustAsHtml(b.title);a.trustAsHtml(b.message);a.trustAsHtml(b.info);c()}ModalCtrl.$inject=["$scope","title","message","$sce","close"];
function FiltersCtrl(c,f,a,b,e){c.title=f;c.fields=a;c.Click={Submit:function(){$.magnificPopup.close();c.Callback.Confirm();e(null,500)},Cancel:function(){$.magnificPopup.close();e(null,500)}};c.Callback={Confirm:function(){},Init:function(){}};function d(){c.Callback.Init()}d()}FiltersCtrl.$inject=["$scope","title","fields","$sce","close"];
function LoginCtrl(d,c,g){d.username=null;d.password=null;d.remember=null;d.formId="loginForm";d.Click={Submit:e,ForgotPassword:b};function f(){if(g.isAuthorized){d.$state.go("content")}$("body").attr("class","external-page external-alt sb-l-c sb-r-c")}function e(){var i=$("#"+d.formId);var h=new Loader(i);$.ajax({url:ConfigPiZone.apiPrefix+"/login",type:"post",data:a(),dataType:"json",beforeSend:function(){if(h.ready==false){h.Create()}},error:function(j){PiZoneException.AjaxError(j,h);h.Delete()},success:function(j){if(j.result=="ok"){c.SetCredentials(d.username,d.password);d.$state.go("content")}else{h.Delete()}}})}function a(){return $("#"+d.formId).serialize()}function b(){}f()}LoginCtrl.$inject=["$scope","SessionService","$sessionStorage"];
function ContentListCtrl(b,d,c,a){angular.extend(b,new ListCtrl(b,d,c,a));b.prefix="content";b.model=Content;b.breadcrumbs=[{title:"Контент"}];b.Init()}ContentListCtrl.$inject=["$scope","$http","$stateParams","ModalService"];
function ContentNewCtrl(b,d){angular.extend(b,new NewCtrl(b,d));b.prefix="content";b.formId="newContentForm";b.breadcrumbs=[{title:"Контент",link:"#/content/"},{title:"Новый контент"}];b.messages.submit.success.title="Новый контент";b.messages.submit.danger.title="Ошибка создания контента";b.Get.Tabs=c;b.Callback.Success=a;function a(){b.messages.submit.success.message='Успешно создан новы контент "'+b.tabs[0].fields[2].value+'"';b.ToList()}function c(e){b.tabs=[{title:"Элемент",fields:[e._token,e.is_active,e.title,e.alias,e.layout]},{title:"Анонс",fields:[e.anons,e.show_editor_anons]},{title:"Подробно",fields:[e.content,e.show_editor_content]},{title:"SEO",fields:[e.meta.form.meta_title,e.meta.form.meta_keywords,e.meta.form.meta_description,e.meta.form.more_scripts,e.meta.form.in_breadcrumbs,e.meta.form.in_site_map,e.meta.form.in_robots]}]}b.Init()}ContentNewCtrl.$inject=["$scope","$http"];
function ContentEditCtrl(c,h,f,b){angular.extend(c,new EditCtrl(c,h,f,b));c.prefix="content";c.formId="editContentForm";c.Get.Tabs=g;c.Callback.Init=e;c.Callback.Success=a;function a(){c.messages.submit.success.message='Успешно изменен контент "'+c.title+'"';c.ToList()}function d(){c.$watch(function(){return c.tabs[1].fields[1].checked},function(j,i){if(j){c.tabs[1].fields[0].type="editor"}else{c.tabs[1].fields[0].type="textarea"}c.tabs[1].fields[0].template=FieldDispatcher.GetLayout(c.tabs[1].fields[0].type)});c.$watch(function(){return c.tabs[2].fields[1].checked},function(j,i){if(j){c.tabs[2].fields[0].type="editor"}else{c.tabs[2].fields[0].type="textarea"}c.tabs[2].fields[0].template=FieldDispatcher.GetLayout(c.tabs[2].fields[0].type)})}function e(){c.messages.submit.success.title="Контент успешно изменен";c.messages.submit.success.message='Успешно изменен контент "'+c.title+'"';c.messages.submit.danger.title="Ошибка редактирования контента";c.messages.remove.confirm.title="Удаление контента";c.messages.remove.confirm.message='<h3 class="mt5">Вы уверены, что хотите удалить контент?</h3><p>Контент "'+c.title+'" будет полностью удален из системы. Совершайте данное действие только в полной уверенности, что это не приведет к ошибкам в отображении страниц!</p>';c.breadcrumbs=[{title:"Контент",link:"#/content/"},{title:'Редактировать контент - "'+c.title+'"'}];d()}function g(i){c.title=i.title.value;c.tabs=[{title:"Элемент",fields:[i._token,i.is_active,i.title,i.alias,i.layout]},{title:"Анонс",fields:[i.anons,i.show_editor_anons]},{title:"Подробно",fields:[i.content,i.show_editor_content]},{title:"SEO",fields:[i.meta.form.meta_title,i.meta.form.meta_keywords,i.meta.form.meta_description,i.meta.form.more_scripts,i.meta.form.in_breadcrumbs,i.meta.form.in_site_map,i.meta.form.in_robots]}]}c.Init()}ContentEditCtrl.$inject=["$scope","$http","$stateParams","ModalService"];
function LayoutListCtrl(b,d,c,a){angular.extend(b,new ListCtrl(b,d,c,a));b.prefix="layout";b.model=Layout;b.breadcrumbs=[{title:"Шаблоны"}];b.Init()}LayoutListCtrl.$inject=["$scope","$http","$stateParams","ModalService"];
function LayoutNewCtrl(b,d){angular.extend(b,new NewCtrl(b,d));b.prefix="layout";b.formId="newLayoutForm";b.breadcrumbs=[{title:"Шаблоны",link:"#/layout/"},{title:"Новый шаблон"}];b.messages.submit.success.title="Новый шаблон";b.messages.submit.danger.title="Ошибка создания шаблона";b.Get.Fields=c;b.Callback.Success=a;function a(){b.messages.submit.success.message='Успешно создан новы шаблон "'+b.fields[2].value+'"';b.ToList()}function c(e){b.fields=[e._token,e.is_active,e.name,e.description,e.file]}b.Init()}LayoutNewCtrl.$inject=["$scope","$http"];
function LayoutEditCtrl(b,g,d,a){angular.extend(b,new EditCtrl(b,g,d,a));b.prefix="layout";b.formId="editLayoutForm";b.Get.Fields=f;b.Callback.Init=c;b.Callback.Delete.Before=e;function c(){b.messages.submit.success.title="Шаблон успешно изменен";b.messages.submit.success.message='Успешно изменен шаблон "'+b.title+'"';b.messages.submit.danger.title="Ошибка редактирования шаблона";b.messages.remove.confirm.title="Удаление шаблона";b.messages.remove.confirm.message='<h3 class="mt5">Вы уверены, что хотите удалить шаблон?</h3><p>Шаблон "'+b.title+'" будет полностью удален из системы. Совершайте данное действие только в полной уверенности, что это не приведет к ошибкам в отображении страниц!</p>';b.breadcrumbs=[{title:"Шаблоны",link:"#/layout/"},{title:'Редактировать шаблон "'+b.title+'"'}]}function e(j){var i=$("#"+b.infoBlockId);var h=new Loader(i);$.ajax({url:ConfigPiZone.apiPrefix+"/layout/"+b.id+"/checkuse",dataType:"json",type:"post",beforeSend:function(){if(h.ready==false){h.Create()}},error:function(k){h.Delete();PiZoneException.AjaxError(k,h)},success:function(l){h.Delete();if(l.result=="ok"&&l.list.length>0){var k='<p>Страницы использующие этот шаблон:</p><ul class="pl15">';$.each(l.list,function(n,m){k=k+'<li><a href="#/content/'+m.id+'/edit/" target="_blank">['+m.id+"] "+m.title+"</a></li>"});k=k+"</ul>";j.info=k;j.$apply()}}})}function f(h){b.title=h.name.value;b.fields=[h._token,h.is_active,h.name,h.description,h.file]}b.Init()}LayoutEditCtrl.$inject=["$scope","$http","$stateParams","ModalService"];
function WebItemListCtrl(b,d,c,a){angular.extend(b,new ListCtrl(b,d,c,a));b.prefix="web_item";b.model=WebItem;b.breadcrumbs=[{title:"Элементы"}];b.Init()}WebItemListCtrl.$inject=["$scope","$http","$stateParams","ModalService"];
function WebItemNewCtrl(b,d){angular.extend(b,new NewCtrl(b,d));b.prefix="web_item";b.formId="newWebItemForm";b.breadcrumbs=[{title:"Элемент",link:"#/web_item/"},{title:"Новый элемент"}];b.messages.submit.success.title="Новый элемент";b.messages.submit.danger.title="Ошибка создания элемента";b.Get.Tabs=c;b.Callback.Success=a;function a(){b.messages.submit.success.message='Успешно создан новы элемент "'+b.tabs[0].fields[2].value+'"';b.ToList()}function c(e){b.tabs=[{title:"Элемент",fields:[e._token,e.is_active,e.alias,e.description]},{title:"Контент",fields:[e.content]}]}b.Init()}WebItemNewCtrl.$inject=["$scope","$http"];
function WebItemEditCtrl(b,f,d,a){angular.extend(b,new EditCtrl(b,f,d,a));b.prefix="web_item";b.formId="editWebItemForm";b.pathToTmpl=ConfigPiZone.pathToTmpl;b.Get.Tabs=e;b.Callback.Init=c;function c(){b.messages.submit.success.title="Элемент успешно изменен";b.messages.submit.success.message='Успешно изменен элемент "'+b.title+'"';b.messages.submit.danger.title="Ошибка редактирования элемента";b.breadcrumbs=[{title:"Элементы",link:"#/web_item/"},{title:'Редактировать элемент - "'+b.title+'"'}]}function e(g){b.title=g.alias.value;b.tabs=[{title:"Элемент",fields:[g._token,g.is_active,g.alias,g.description]},{title:"Контент",fields:[g.content]}]}b.Init()}WebItemEditCtrl.$inject=["$scope","$http","$stateParams","ModalService"];
function MenuListCtrl(b,d,c,a){angular.extend(b,new ListCtrl(b,d,c,a));b.prefix="menu";b.model=Menu;b.breadcrumbs=[{title:"Меню"}];b.Init()}MenuListCtrl.$inject=["$scope","$http","$stateParams","ModalService"];
function MenuNewCtrl(b,d){angular.extend(b,new NewCtrl(b,d));b.prefix="menu";b.formId="newMenuForm";b.breadcrumbs=[{title:"Меню",link:"#/menu/"},{title:"Новое меню"}];b.messages.submit.success.title="Новое меню";b.messages.submit.danger.title="Ошибка создания меню";b.Get.Fields=c;b.Callback.Success=a;function a(){b.messages.submit.success.message='Успешно создано новое меню "'+b.fields[2].value+'"';b.ToList()}function c(e){b.fields=[e._token,e.is_active,e.name,e.alias,e.file]}b.Init()}MenuNewCtrl.$inject=["$scope","$http"];
function MenuEditCtrl(b,f,d,a){angular.extend(b,new EditCtrl(b,f,d,a));b.prefix="menu";b.formId="editMenuForm";b.Get.Fields=e;b.Callback.Init=c;function c(){b.messages.submit.success.title="Меню успешно изменено";b.messages.submit.success.message='Успешно изменено меню "'+b.title+'"';b.messages.submit.danger.title="Ошибка редактирования меню";b.messages.remove.confirm.title="Удаление меню";b.messages.remove.confirm.message='<h3 class="mt5">Вы уверены, что хотите удалить меню?</h3><p>Меню "'+b.title+'" будет полностью удалено из системы. Совершайте данное действие только в полной уверенности, что это не приведет к ошибкам в отображении страниц!</p>';b.breadcrumbs=[{title:"Меню",link:"#/menu/"},{title:'Редактировать меню "'+b.title+'"'}]}function e(g){b.title=g.name.value;b.fields=[g._token,g.is_active,g.name,g.alias]}b.Init()}MenuEditCtrl.$inject=["$scope","$http","$stateParams","ModalService"];
function Model(g,f,e,b){var j=this;j.prefix="";j.isActive=null;j._token=null;j.Click={Active:d};j.messages={active:{success:{title:"Активация",message:"Элемент активирован"},warning:{title:"Деактивация",message:"Элемент деактивирован"},danger:{title:"Ошибка активации",message:"Элемент не был активирован."}},remove:{confirm:{title:"Удаление элемента",message:"Вы уверенны, что хотите удалить элемент?",info:""},success:{title:"Удаление",message:"Элемент успешно удален"},danger:{title:"Ошибка удаления",message:"Возникла ошибка при удалении элемента."}}};j.Callback={Active:{Success:function(){},Warning:function(){},Error:function(){}},Delete:{Before:function(){},Success:function(){},Error:function(){}}};j.Delete=h;function d(){var i=ConfigPiZone.apiPrefix+"/"+g.list[f].prefix+"/"+g.list[f].id+"/set/"+(g.list[f].isActive?"inactive":"active");$.ajax({url:i,dataType:"json",success:function(k){if(k.hasOwnProperty("active")){g.list[f].isActive=k.active}if(k.result=="ok"){if(g.list[f].isActive){g.list[f].Callback.Active.Success(k);a("active","success")}else{g.list[f].Callback.Active.Warning(k);a("active","warning")}}else{g.list[f].Callback.Active.Error(k);a("active","danger")}g.$apply()}})}function h(){b.showModal({templateUrl:ConfigPiZone.pathToTmpl+"admindesignes/confirm.html",controller:"ModalCtrl",id:"modalConfirm",inputs:{title:j.messages.remove.confirm.title,message:j.messages.remove.confirm.message}}).then(function(i){i.scope.Callback.Confirm=c;j.Callback.Delete.Before(i.scope)})}function c(){var i=ConfigPiZone.apiPrefix+"/"+g.list[f].prefix+"/"+g.list[f].id+"/delete";$.ajax({url:i,dataType:"json",type:"post",data:{_token:g.list[f]._token},error:function(k){if(k.status==404){g.list[f].message.remove.danger.message="Элемент с [id] = "+g.list[f].id+" не существует!"}if(k.status==400){g.list[f].message.remove.danger.message="Неверные параметры запроса!"}if(k.status==500){g.list[f].message.remove.danger.message="Возникла непредвиденная ошибка сервера!"}j.Callback.Delete.Error();a("remove","danger")},success:function(k){if(k.result=="ok"){a("remove","success");j.Callback.Delete.Success();EventDispatcher.DispatchEvent("update_page_"+g.list[f].prefix)}else{j.Callback.Delete.Error();a("remove","danger")}g.$apply()}})}function a(k,i){new Notify({type:i,title:g.list[f].messages[k][i].title,text:g.list[f].messages[k][i].message})}};
function Content(c,d,e,a){angular.extend(this,new Model(c,d,e,a));var b=this;b.prefix="content";b.id=e.id;b.title=e.title;b.alias=e.alias;b.anons=e.anons;b.showEditorAnons=e.show_editor_anons;b.content=e.content;b.showEditorContent=e.show_editor_content;b.meta=e.meta;b.isActive=e.isActive;b._token=e._token;b.messages.active.success.title="Контент активирован";b.messages.active.success.message='Успешно активирован контент - "'+b.title+'"';b.messages.active.warning.title="Контент деактивирован";b.messages.active.warning.message='Успешно деактивирован контент - "'+b.title+'"';b.Callback.Active.Error=function(f){b.messages.active.danger.message='Контент - "'+b.title+'" не был активирован.<br/><b>Ошибка:</b> '+f.message+".<br/>Обратитесь к администратору"}};
function Layout(c,d,e,a){angular.extend(this,new Model(c,d,e,a));var b=this;b.prefix="layout";b.id=e.id;b.name=e.name;b.description=e.description;b.isActive=e.isActive;b._token=e._token;b.messages.active.success.title="Шаблон активирован";b.messages.active.success.message='Успешно активирован шаблон - "'+b.name+'"';b.messages.active.warning.title="Шаблон деактивирован";b.messages.active.warning.message='Успешно деактивирован шаблон - "'+b.name+'"';b.messages.remove.confirm.title="Удаление шаблона";b.messages.remove.confirm.message='<h3 class="mt5">Вы уверены, что хотите удалить шаблон?</h3><p>Шаблон "'+b.name+'" будет полностью удален из системы. Совершайте данное действие только в полной уверенности, что это не приведет к ошибкам в отображении страниц!</p>';b.Callback.Active.Error=function(f){b.messages.active.danger.message='Шаблон - "'+b.name+'" не был активирован.<br/><b>Ошибка:</b> '+f.message+".<br/>Обратитесь к администратору"};b.Callback.Delete.Before=function(h){var g=$("#"+c.infoBlockId);var f=new Loader(g);$.ajax({url:ConfigPiZone.apiPrefix+"/layout/"+b.id+"/checkuse",dataType:"json",type:"post",beforeSend:function(){if(f.ready==false){f.Create()}},error:function(i){f.Delete();PiZoneException.AjaxError(i,f)},success:function(j){f.Delete();if(j.result=="ok"&&j.list.length>0){var i='<p>Страницы использующие этот шаблон:</p><ul class="pl15">';$.each(j.list,function(l,k){i=i+'<li><a href="#/content/'+k.id+'/edit/" target="_blank">['+k.id+"] "+k.title+"</a></li>"});i=i+"</ul>";h.info=i;h.$apply()}}})}};
function WebItem(c,d,e,a){angular.extend(this,new Model(c,d,e,a));var b=this;b.prefix="web_item";b.id=e.id;b.alias=e.alias;b.description=e.description;b.content=e.content;b.isActive=e.isActive;b._token=e._token;b.messages.active.success.title="Элемент активирован";b.messages.active.success.message='Успешно активирован элемент - "'+b.alias+'"';b.messages.active.warning.title="Элемент деактивирован";b.messages.active.warning.message='Успешно деактивирован элемент - "'+b.alias+'"';b.messages.remove.confirm.message='<h3 class="mt5">Вы уверены, что хотите удалить элемент?</h3><p>Элемент "'+b.alias+'" будет полностью удален из системы. Совершайте данное действие только в полной уверенности, что это не приведет к ошибкам в отображении страниц!</p>';b.Callback.Active.Error=function(f){b.messages.active.danger.message='Элемент - "'+b.alias+'" не был активирован.<br/><b>Ошибка:</b> '+f.message+".<br/>Обратитесь к администратору"}};
function Menu(c,d,e,a){angular.extend(this,new Model(c,d,e,a));var b=this;b.prefix="menu";b.id=e.id;b.name=e.name;b.alias=e.alias;b.isActive=e.isActive;b._token=e._token;b.messages.active.success.title="Меню активировано";b.messages.active.success.message='Успешно активировано меню - "'+b.name+'"';b.messages.active.warning.title="Меню деактивировано";b.messages.active.warning.message='Успешно деактивировано меню - "'+b.name+'"';b.messages.remove.confirm.title="Удаление меню";b.messages.remove.confirm.message='<h3 class="mt5">Вы уверены, что хотите удалить меню?</h3><p>Меню "'+b.name+'" будет полностью удалено из системы. Совершайте данное действие только в полной уверенности, что это не приведет к ошибкам в отображении страниц!</p>';b.Callback.Active.Error=function(f){b.messages.active.danger.message='Меню - "'+b.name+'" не был активировано.<br/><b>Ошибка:</b> '+f.message+".<br/>Обратитесь к администратору"}};
(function(){angular.module("PiZoneAuth",[]).service("SessionService",["$injector","$rootScope","$sessionStorage","$http","$cookies",function(h,g,f,e,a){var d={};d.CheckAccess=c;d.SetCredentials=i;d.ClearCredentials=b;return d;function c(n,j,m,o,l){var k=h.get("$rootScope");if(j.data!==undefined){if(j.data.noLogin!==undefined&&j.data.noLogin){}}else{if(!f.isAuthorized){n.preventDefault();k.$state.$last=k.$state.current;k.$state.go("login")}}}function i(l,j){var k=Base64.Encode(l+":"+j);f.isAuthorized=true;e.defaults.headers.common.Authorization="Basic "+k;a.put("token",k)}function b(){g.globals={};f.isAuthorized=false;a.remove("token");e.defaults.headers.common.Authorization="Basic "}}])})();
(function(){var a=angular.module("PiZoneModalService",[]);a.factory("ModalService",["$document","$compile","$controller","$http","$rootScope","$q","$templateCache",function(e,f,b,i,j,h,d){var g=e.find("body");function c(){var l=this;var k=function(o,p){var m=h.defer();if(o){m.resolve(o)}else{if(p){var n=d.get(p);if(n!==undefined){m.resolve(n)}else{i({method:"GET",url:p,cache:true}).then(function(q){d.put(p,q.data);m.resolve(q.data)},function(q){m.reject(q)})}}else{m.reject("No template or templateUrl has been specified.")}}return m.promise};l.showModal=function(n){var m=h.defer();var o=n.controller;if(!o){m.reject("No controller has been specified.");return m.promise}if(n.controllerAs){o=o+" as "+n.controllerAs}k(n.template,n.templateUrl).then(function(x){var s=j.$new();var y=h.defer();var u={$scope:s,close:function(z,A){if(A===undefined||A===null){A=0}window.setTimeout(function(){if(y){y.resolve(z)}if(s){s.$destroy()}if(p){p.remove()}if(u){u.close=null}m=null;y=null;w=null;u=null;p=null;s=null},A)}};if(n.inputs){for(var v in n.inputs){u[v]=n.inputs[v]}}var r=angular.element(x);var t=f(r);var p=t(s);if(n.id){p.attr({id:n.id})}u.$element=p;var q=b(o,u);if(n.appendElement){n.appendElement.append(p)}else{g.append(p)}var w={controller:q,scope:s,element:p,close:y.promise};m.resolve(w);$.magnificPopup.open({removalDelay:500,items:{src:"#"+n.id},callbacks:{beforeOpen:function(z){this.st.mainClass="mfp-zoomIn"},close:function(){u.close()}},midClick:true})}).then(null,function(p){m.reject(p)});return m.promise}}return new c()}])}());
(function(){angular.module("PiZoneControllers",[]).controller("MainCtrl",MainCtrl).controller("BreadcrumbsCtrl",BreadcrumbsCtrl).controller("UserInfoCtrl",UserInfoCtrl).controller("LoginCtrl",LoginCtrl).controller("ModalCtrl",ModalCtrl).controller("FiltersCtrl",FiltersCtrl).controller("LayoutListCtrl",LayoutListCtrl).controller("LayoutNewCtrl",LayoutNewCtrl).controller("LayoutEditCtrl",LayoutEditCtrl).controller("ContentListCtrl",ContentListCtrl).controller("ContentNewCtrl",ContentNewCtrl).controller("ContentEditCtrl",ContentEditCtrl).controller("WebItemListCtrl",WebItemListCtrl).controller("WebItemNewCtrl",WebItemNewCtrl).controller("WebItemEditCtrl",WebItemEditCtrl).controller("MenuListCtrl",MenuListCtrl).controller("MenuNewCtrl",MenuNewCtrl).controller("MenuEditCtrl",MenuEditCtrl)})();
(function(){var a=ConfigPiZone.pathToTmpl;angular.module("backend",["ui.router","ngCookies","ngStorage","ngSanitize","PiZoneControllers","PiZoneAuth","PiZoneModalService"]).config(["$stateProvider","$urlRouterProvider","$httpProvider",function(d,b,c){b.otherwise("/content/");d.state("main",{"abstract":true,url:"",views:{"@":{templateUrl:"/admin/tmpl/content.html",controller:"MainCtrl"}}}).state("content",{url:"/content/:pageId?sort&order_by",parent:"main",views:{content:{templateUrl:a+"content/list.html",controller:"ContentListCtrl"}}}).state("content.new",{url:"/content/new/",parent:"main",views:{content:{templateUrl:a+"content/new.html",controller:"ContentNewCtrl"}}}).state("content.edit",{url:"/content/:id/edit/",parent:"main",views:{content:{templateUrl:a+"content/edit.html",controller:"ContentEditCtrl"}}}).state("layout",{url:"/layout/:pageId?sort&order_by",parent:"main",views:{content:{templateUrl:a+"layout/list.html",controller:"LayoutListCtrl"}}}).state("layout.new",{url:"/layout/new/",parent:"main",views:{content:{templateUrl:a+"layout/new.html",controller:"LayoutNewCtrl"}}}).state("layout.edit",{url:"/layout/:id/edit/",parent:"main",views:{content:{templateUrl:a+"layout/edit.html",controller:"LayoutEditCtrl"}}}).state("web_item.new",{url:"/web_item/new/",parent:"main",views:{content:{templateUrl:a+"webitem/new.html",controller:"WebItemNewCtrl"}}}).state("web_item",{url:"/web_item/:pageId?sort&order_by",parent:"main",views:{content:{templateUrl:a+"webitem/list.html",controller:"WebItemListCtrl"}}}).state("web_item.edit",{url:"/web_item/:id/edit/",parent:"main",views:{content:{templateUrl:a+"webitem/edit.html",controller:"WebItemEditCtrl"}}}).state("menu",{url:"/menu/:pageId?sort&order_by",parent:"main",views:{content:{templateUrl:a+"menu/list.html",controller:"MenuListCtrl"}}}).state("menu.new",{url:"/menu/new/",parent:"main",views:{content:{templateUrl:a+"menu/new.html",controller:"MenuNewCtrl"}}}).state("menu.edit",{url:"/menu/:id/edit/",parent:"main",views:{content:{templateUrl:a+"menu/edit.html",controller:"MenuEditCtrl"}}}).state("login",{url:"/login",views:{"@":{templateUrl:a+"security/login.html",controller:"LoginCtrl"}},data:{noLogin:true}});c.interceptors.push("authInterceptor")}]).directive("tabPizone",TabPizone).directive("buttonActivePizone",ButtonActivePizone).directive("listButtonGroupPizone",ListButtonGroupPizone).directive("perPagePizone",PerPagePizone).directive("fieldSortPizone",FieldSortPizone).factory("authInterceptor",AuthInterceptor).run(["$rootScope","$state","$stateParams","SessionService",function(b,d,e,c){b.$state=d;b.$stateParams=e;b.user=null;b.$on("$stateChangeStart",function(i,f,h,j,g){c.CheckAccess(i,f,h,j,g)})}])})();